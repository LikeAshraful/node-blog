const express=require("express"),passport=require("passport"),User=require("../models/User"),router=express.Router();router.get("/register",((req,res)=>{res.render("register",{layout:"layouts/auth"})})),router.post("/register",(async(req,res)=>{try{const{username:username,password:password}=req.body,user=new User({username:username,password:password});await user.save(),res.redirect("/login")}catch(err){res.status(500).send("Error registering new user")}})),router.get("/login",((req,res)=>{res.render("login",{layout:"layouts/auth"})})),router.post("/login",passport.authenticate("local",{successRedirect:"/",failureRedirect:"/login",failureFlash:!0})),router.get("/logout",((req,res)=>{req.logout((err=>{if(err)return next(err);res.redirect("/")}))})),module.exports=router;